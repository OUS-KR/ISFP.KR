<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ISFP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262871645049971" crossorigin="anonymous"></script>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ISFP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ISFP 운세</h1>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="2065367733"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ISFP 지수</div>
                <p id="mbtiIndexDisplay">ISFP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="giscus-container" style="margin: 15px 0;"></div>
        <script>
            function loadGiscus() {
                const container = document.getElementById('giscus-container');
                while (container.firstChild) container.removeChild(container.firstChild);
                
                const script = document.createElement('script');
                script.src = 'https://giscus.app/client.js';
                script.setAttribute('data-repo', 'OUS-KR/ISFP.KR');
                script.setAttribute('data-repo-id', 'R_kgDOOrfScQ');
                script.setAttribute('data-category', 'Announcements');
                script.setAttribute('data-category-id', 'DIC_kwDOOrfScc4CqQAN');
                script.setAttribute('data-mapping', 'pathname');
                script.setAttribute('data-strict', '0');
                script.setAttribute('data-reactions-enabled', '1');
                script.setAttribute('data-emit-metadata', '1');
                script.setAttribute('data-input-position', 'top');
                script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light');
                script.setAttribute('data-loading', 'lazy');
                script.setAttribute('data-lang', 'ko');
                script.setAttribute('crossorigin', 'anonymous');
                script.setAttribute('async', '');
                
                container.appendChild(script);
            }
            
            loadGiscus();
        </script>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251020100500" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts (ISFP) ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["당신의 독특한 미적 감각이", "현재를 즐기는 여유로운 마음이", "타인을 향한 따뜻한 공감 능력이", "자유를 추구하는 영혼이", "겸손하고 온화한 태도가"],
            verbs: ["일상에 아름다움을 더해줍니다.", "사소한 것에서 큰 행복을 발견하게 합니다.", "주변 사람들에게 진정한 위로를 줍니다.", "틀에 박힌 생각에서 벗어나게 합니다.", "자연스럽게 사람들을 당신의 편으로 만듭니다."],
            connectors: ["그러니", "이 기회를 활용해", "자신감을 갖고", "망설이지 말고"],
            actions: ["마음에 드는 풍경을 사진이나 그림으로 남겨보세요.", "좋아하는 음악을 들으며 아무 생각 없이 휴식을 취하세요.", "당신의 감정을 솔직하게 표현하는 것을 두려워하지 마세요.", "계획 없이 발길 닿는 대로 산책을 떠나보세요.", "자신에게 작은 선물을 하며 스스로를 칭찬해 주세요."]
        },
        task: {
            types: ["표현하기:", "느끼기:", "탐험하기:", "공감하기:"],
            actions: ["오늘 당신의 기분을", "길을 걷다 마주친", "한 번도 가보지 않은", "최근 힘들어하는"],
            subjects: ["하나의 색깔", "작은 들꽃", "동네의 골목길", "친구의 이야기"],
            verbs: ["(으)로 표현한다면 무엇일지 생각해 보세요.", "의 아름다움을 잠시 멈춰서 감상해 보세요.", "을(를) 탐험하며 새로운 것을 발견해 보세요.", "를 들으며 진심으로 마음을 나눠보세요."]
        },
        mbtiIndex: {
            reasons: ["예술적인 감성이 폭발하여", "현재 순간의 아름다움을 온전히 느껴", "타인의 감정에 깊이 공감하여", "자유로운 영혼이 새로운 모험을 꿈꿔"],
            results: ["세상을 당신만의 색깔로 표현할 수 있습니다.", "일상의 모든 순간이 특별한 의미를 갖게 됩니다.", "주변 사람들에게 따뜻한 위로와 영감을 줍니다.", "예상치 못한 곳에서 새로운 즐거움을 발견하게 됩니다."]
        },
        keywords: ["따뜻한", "친절한", "배려심 깊은", "예술적인", "감수성 풍부한", "독특한", "개성적인", "자유로운", "즉흥적인", "현재 지향적", "경험 중시", "유연한", "관용적인", "온화한", "겸손한", "모험가", "예술가", "조력자", "공감", "조화", "진정성", "독립성", "미적 감각"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>